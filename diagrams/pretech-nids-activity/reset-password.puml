@startuml
title PreTech-NIDS - Reset Password Activity
hide circle

start
:User accesses forgot password page;

:Display password reset form;

:User enters email address;

:Validate email format;
if (Format valid?) then (yes)
else (no)
  :Show format error message;
  :Return to reset form;
  stop
endif

:Send password reset request;
note right: POST /auth/password-reset/initiate-otp

:Check if user exists;
if (User found?) then (yes)
else (no)
  :Show "User not found" error;
  :Return to reset form;
  stop
endif

:Generate 6-digit OTP code;

:Store OTP in database;
note right: 10 minutes expiry, used=false

:Send OTP via email;
note right: SMTP service

:Display "OTP sent" message;

:User receives email;

:User enters OTP code;

:Validate OTP code;
note right: POST /auth/password-reset/verify-otp

:Check OTP validity;
if (OTP valid and not expired?) then (yes)
else (no)
  :Show "Invalid or expired OTP" error;
  :Return to OTP input;
  stop
endif

:Display "OTP verified" message;

:User enters new password;

:Validate password strength;
if (Password meets requirements?) then (yes)
else (no)
  :Show password strength error;
  :Return to password input;
  stop
endif

:User confirms new password;

:Check password confirmation;
if (Passwords match?) then (yes)
else (no)
  :Show "Passwords don't match" error;
  :Return to password input;
  stop
endif

:Send password reset completion;
note right: POST /auth/password-reset/complete

:Hash new password;

:Update user password in database;

:Mark OTP as used;

:Display "Password reset successful" message;

:Redirect to login page;

stop
@enduml
